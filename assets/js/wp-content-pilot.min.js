jQuery(document).ready(function(d){"use strict";d.wp_content_pilot={init:function(){d(".wpcp-tooltip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),d(".wpcp-range-slider").ionRangeSlider({skin:"round"}),d(".wpcp-select2").select2({theme:"default wpcp-select2"}),d("#wpcp-campaign-log").insertAfter(d("#wpcp-campaign-status"))},hideKeywordField:function(){var e=d("#_keywords"),t=d("#_keyword_suggestion"),n=e.closest("p._keywords-field"),a=t.closest("p._keyword_suggestion-field");e.attr("disabled","disabled"),t.attr("disabled","disabled"),n.hide(),a.hide()},showKeywordField:function(){var e=d("#_keywords"),t=d("#_keyword_suggestion"),n=e.closest("p._keywords-field"),a=t.closest("p._keyword_suggestion-field");e.removeAttr("disabled"),t.removeAttr("disabled"),n.show(),a.show()},youtube:function(){d("#_youtube_search_type").on("change",function(){var e=d("._youtube_playlist_id-field"),t=d("._youtube_channel_id-field");console.log(d(this).val()),"global"===d(this).val()?(e.hide(),t.hide(),d.wp_content_pilot.showKeywordField()):("channel"===d(this).val()?(t.show(),e.hide()):(e.show(),t.hide()),d.wp_content_pilot.hideKeywordField())}).change()},deleteCampaignPosts:function(e){if(e.preventDefault(),confirm("Are you sure?")){var t=d(this),n=d(this).next(),a=t.data("campid"),i=t.data("nonce");t.attr("disabled",!0),n.addClass("active"),t.attr("disabled",!0),n.addClass("active"),wp.ajax.send({data:{action:"wpcp_delete_all_campaign_posts",camp_id:a,nonce:i},success:function(){n.removeClass("active"),t.attr("disabled",!1),n.removeClass("active"),t.attr("disabled",!1),window.location.reload()},error:function(e){t.attr("disabled",!1),console.log(e)}})}},clearLogs:function(e){if(e.preventDefault(),confirm("Are you sure?")){var t=d(this),n=t.data("nonce");wp.ajax.send({data:{action:"wpcp_clear_logs",nonce:n},success:function(){t.attr("disabled",!1),window.location.reload()},error:function(e){t.attr("disabled",!1),console.log(e)}})}},handle_manual_campaign:function(e){e.preventDefault();var t=d(this);t.hide(),t.prev(".spinner").show().addClass("is-active"),t.attr("disabled","disabled");var n,a=d("#wpcp-campaign-log"),i=a.find(".wpcp-campaign-log-list"),o=parseInt(t.attr("data-campaign_id"),10),c=parseInt(t.attr("data-instance"),10),s=d(".wpcp-last-article-link");function l(e){return e.message?d("<p>").addClass(e.level).html("["+e.time+"] - "+e.message):""}window.wpcp_interval,window.wpcp_logger_offset=0,window.wpcp_run_instance=c,i.html(""),a.fadeIn("slow"),n=wp.ajax.post("wpcp_run_manual_campaign",{nonce:wp_content_pilot_i10n.nonce,campaign_id:o,instance:c}),window.wpcp_interval=setInterval(function(){wp.ajax.post("wpcp_get_campaign_instance_log",{nonce:wp_content_pilot_i10n.nonce,campaign_id:o,instance:c,offset:wpcp_logger_offset}).always(function(e){window.wpcp_logger_offset+=e.length,e.length&&(e.forEach(function(e){i.append(l(e))}),i.scrollTop(i.height()))}),window.wpcp_run_instance||(clearInterval(window.wpcp_interval),window.wpcp_logger_offset=0)},500),n.always(function(e){t.removeAttr("disabled"),t.prev(".spinner").hide(),t.show(),t.attr("data-instance",Math.floor(Date.now()/1e3)),i.append(l(e)),e.link&&(s.find("a").remove(),s.append(e.link),s.find("a").addClass("wpcp-blink")),delete window.wpcp_run_instance})}},d.wp_content_pilot.init(),d.wp_content_pilot.youtube(),d("#wpcp-delete-campaign-posts").on("click",d.wp_content_pilot.deleteCampaignPosts),d("#wpcp-clear-logs").on("click",d.wp_content_pilot.clearLogs),d("#wpcp-run-campaign").on("click",d.wp_content_pilot.handle_manual_campaign)});